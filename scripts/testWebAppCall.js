const { ethers } = require("hardhat");

async function main() {
  const factoryAddress = "0x4962e5cCBfE4258B9229bfff705cCacA4379f49f";

  // The exact calldata from the web app
  const calldata = "0x4cfff15000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002e00000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000000e466f7572206d6f72652044414f730000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003464d4400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018617364617320716e776f64696e717720646f696e617320640000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000006e5b15bc39f921e1503073dbb8a5da2fc6220e900000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000120d4da7b0bd140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003e6a7572697364696374696f6e2e7061726974792e30783739366561313166613264643735316564303162353363333732666664623461616138663030663900000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000133130303030303030303030303030303030303000000000000000000000000000";

  console.log("Testing web app call to StandardFactory");
  console.log("Factory:", factoryAddress);
  console.log("\nDecoding calldata...\n");

  // Try to decode with different function signatures
  const signatures = [
    "function deployDAOwithToken(string,string,string,uint8,uint256,address[],uint256[],string[],string[])",
    "function deployDAOwithToken((string,string,string,uint8,uint256,address[],uint256[],string[],string[]))"
  ];

  for (const sig of signatures) {
    try {
      const iface = new ethers.Interface([sig]);
      const decoded = iface.decodeFunctionData("deployDAOwithToken", calldata);
      console.log("✓ Decoded with signature:", sig);
      console.log("\nParameters:");
      console.log(decoded);
      console.log("\n");
    } catch (e) {
      console.log("✗ Failed with signature:", sig);
      console.log("  Error:", e.message.split('\n')[0]);
    }
  }

  // Now try to call it
  console.log("\nTrying actual call...");
  const factory = await ethers.getContractAt("StandardFactory", factoryAddress);
  const [signer] = await ethers.getSigners();

  try {
    const tx = await signer.sendTransaction({
      to: factoryAddress,
      data: calldata,
      gasLimit: 10000000
    });
    console.log("✓ Transaction would succeed!");
    console.log("Hash:", tx.hash);
  } catch (error) {
    console.log("✗ Transaction failed:");
    console.log("Error:", error.message);

    // Try with staticCall for more details
    try {
      await ethers.provider.call({
        to: factoryAddress,
        data: calldata,
        from: signer.address
      });
    } catch (staticError) {
      console.log("\nStatic call error:");
      console.log(staticError);
    }
  }
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
